# Run full app (backend + frontend) with persistent data. Good for local or a single server.
# Put DATABASE_URL, GUI_JWT_SECRET, RESEND_API_KEY, RESEND_FROM (and any other env vars) in a .env file in this directory.
services:
  app:
    build: .
    ports:
      - "8000:8000"
    env_file:
      - .env
    environment:
      - PORT=8000
      - DATABASE_URL=${DATABASE_URL}
      - GUI_JWT_SECRET=${GUI_JWT_SECRET}
      - RESEND_API_KEY=${RESEND_API_KEY}
      - RESEND_FROM=${RESEND_FROM}
    volumes:
      # Persist parquet and search log across restarts
      - sanctions-data:/app/data
    restart: unless-stopped

  worker:
    build: .
    command: ["python", "screening_worker.py"]
    env_file:
      - .env
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - SCREENING_WORKER_POLL_SECONDS=${SCREENING_WORKER_POLL_SECONDS:-5}
      - SCREENING_JOBS_RETENTION_DAYS=${SCREENING_JOBS_RETENTION_DAYS:-7}
      - SCREENED_ENTITIES_RETENTION_MONTHS=${SCREENED_ENTITIES_RETENTION_MONTHS:-0}
      - SCREENING_CLEANUP_EVERY_N_LOOPS=${SCREENING_CLEANUP_EVERY_N_LOOPS:-50}
    volumes:
      - sanctions-data:/app/data
    depends_on:
      - app
    restart: unless-stopped

volumes:
  sanctions-data:
